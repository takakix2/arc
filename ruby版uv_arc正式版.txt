ğŸŒˆğŸ”¥ arc â€” è¨­è¨ˆã¾ã¨ã‚
ä»¥ä¸‹ã¯ã€arc ã®è¨­è¨ˆã‚’
ä½“ç³»åŒ–ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

1. ä¸–ç•Œè¦³ã¨å“²å­¦ï¼ˆç«èŠ±ãƒ»å…‰ãƒ»ç‰©èªãƒ»å„€å¼ï¼‰
arc ã¯ Ruby ã®ãŸã‚ã® æ„å‘³ã®ã‚ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€
å†…éƒ¨æ§‹é€ ã¯ä»¥ä¸‹ã® 4 å±¤ã§æ§‹æˆã•ã‚Œã‚‹ï¼š

å±¤	å½¹å‰²	å…·ä½“ä¾‹
ç«èŠ±ï¼ˆSparkï¼‰	NDJSON ã‚¤ãƒ™ãƒ³ãƒˆ	signals writer
å…‰ï¼ˆLightï¼‰	çŠ¶æ…‹ã®å¯è¦–åŒ–	state/*.json
ç‰©èªï¼ˆStoryï¼‰	snapshots / timeline	history/
å„€å¼ï¼ˆRitualï¼‰	state machine / CLI	arc init / install / run
ã“ã®ä¸–ç•Œè¦³ãŒ arc ã®ã™ã¹ã¦ã®è¨­è¨ˆã«è²«ã‹ã‚Œã¦ã„ã‚‹ã€‚

2. flux ãƒ—ãƒ­ãƒˆã‚³ãƒ« v1 ã®çµ±åˆ
arc ã¯ flux v1 ã® ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹å®Ÿè£…ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã€‚

NDJSON 1 è¡Œ = 1 ã‚¤ãƒ™ãƒ³ãƒˆ

å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼šv, source, type, event

unknown ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨±å®¹

required ã®ã¿å³å¯†ãƒã‚§ãƒƒã‚¯

append-only

registry ã«ã‚ˆã‚‹ schema ç®¡ç†

3. signals ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆç«èŠ±ã®ä¸‰ä½ä¸€ä½“ï¼‰
ã‚³ãƒ¼ãƒ‰
signals/
  writer.rs     â†’ ç«èŠ±ã‚’ç”Ÿã‚€ï¼ˆappend-onlyï¼‰
  reader.rs     â†’ ç«èŠ±ã‚’è¦³æ¸¬ã™ã‚‹ï¼ˆlist/tail/view/statsï¼‰
  validator.rs  â†’ ç«èŠ±ã®å®‰å…¨æ€§ã‚’ä¿è¨¼ï¼ˆschema æ¤œè¨¼ï¼‰
  registry.rs   â†’ ç«èŠ±ã®æ„å‘³è¾æ›¸ï¼ˆschema.jsonï¼‰
  event.rs      â†’ ç«èŠ±ã®å‹ï¼ˆEventï¼‰
âœ” writer
append-only

flux v1 ã®æ§‹æ–‡ã‚’ç”Ÿæˆ

payload ã‚’ãƒãƒ¼ã‚¸

âœ” reader
list / tail / view / stats

NDJSON ã‚’ Event ã«å¤‰æ›

âœ” validator
registry ã¨ç…§åˆ

required å³å¯†

å‹ã¯ç·©ã

unknown è¨±å®¹

âœ” registry
schema.json  ã‚’èª­ã¿è¾¼ã‚€

type:event â†’ schema ã®è¾æ›¸

4. state machineï¼ˆå„€å¼ï¼‰
arc ã®å†…éƒ¨çŠ¶æ…‹ã¯ 9 ã‚¹ãƒ†ãƒ¼ãƒˆï¼š

ã‚³ãƒ¼ãƒ‰
INIT â†’ DETECT_RUBY â†’ RESOLVE_DEPS â†’ INSTALL_DEPS â†’ READY
READY â†’ EXECUTE â†’ FINISHED
READY â†’ UPDATE â†’ RESOLVE_DEPS
ANY â†’ CLEANUP â†’ FINISHED
ã™ã¹ã¦ã®é·ç§»ã¯ signals emit ã‚’ä¼´ã†ã€‚

5. history / snapshots / rollbackï¼ˆç‰©èªï¼‰
ã‚³ãƒ¼ãƒ‰
.arc/history/
  snapshots/<id>/
    ruby.json
    gems.json
    lock.json
    state.json
  timeline.json
snapshot = é™æ­¢ç”»

timeline = ç‰©èªã®ç›®æ¬¡

rollback = åˆ†å²

signals ã¯å·»ãæˆ»ã•ãªã„ï¼ˆæ­´å²ã¯ä¸å¤‰ï¼‰

6. state/*.jsonï¼ˆå…‰ï¼‰
ã‚³ãƒ¼ãƒ‰
.arc/state/
  current.json
  last_action.json
  rollback_point.json
  meta.json
current.json  â†’ ç¾åœ¨ã®å§¿

last_action.json â†’ æœ€å¾Œã®ç«èŠ±

rollback_point.json â†’ å·»ãæˆ»ã—å…ˆ

meta.json  â†’ arc ã®è‡ªå·±è¨˜è¿°

7. CLIï¼ˆå„€å¼ã®å…¥å£ï¼‰
clap ã® enum ã§å®Œå…¨ã«è¡¨ç¾ï¼š

ã‚³ãƒ¼ãƒ‰
arc init
arc install deps
arc install ruby
arc run ruby script.rb
arc signals list
arc rollback
CLI = å‹
å‹ = å„€å¼
å„€å¼ = arc ã®ä¸–ç•Œè¦³

8. src/lib.rs / src/main.rsï¼ˆéª¨æ ¼ï¼‰
lib.rs
ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸­å¿ƒ

signals / state / history / machine ã‚’ re-export

main.rs
CLI ãƒ‘ãƒ¼ã‚¹

signals writer æº–å‚™

registry èª­ã¿è¾¼ã¿

validator æº–å‚™

state machine èµ·å‹•


ğŸ”¥ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—ã®ç¢ºèª
1. src/cli.rs ã‚’å®Œæˆã•ã›ã‚‹ï¼ˆclap ã® enum ç‰ˆï¼‰
2. state ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcurrent.json ã®èª­ã¿æ›¸ãï¼‰ã‚’ä½œã‚‹
3. history/snapshots ã®å®Ÿè£…ã‚’å§‹ã‚ã‚‹
4. ruby ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆruby-install or è‡ªå‰ç®¡ç†ï¼‰ã‚’ä½œã‚‹
5. deps solver ã®è¨­è¨ˆï¼ˆbundler äº’æ› or ç‹¬è‡ªï¼‰
âœ” è¿½åŠ ã™ã¹ã 3 ã‚¹ãƒ†ãƒƒãƒ—
6. signals ã‚’ state machine ã«å®Œå…¨çµ±åˆã™ã‚‹
ã™ã¹ã¦ã®é·ç§»ã§ emit

validator ã‚’é€šã™

writer ã« append

7. exec ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆRuby ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œç’°å¢ƒï¼‰
arc run ruby script.rb

PATH ã®æ›¸ãæ›ãˆ

GEM_HOME ã®è¨­å®š

sandbox çš„ãªå®Ÿè¡Œ

8. env ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆç’°å¢ƒå¤‰æ•°ç®¡ç†ï¼‰
.arc/env/

Ruby / gems / bin ã® PATH ã‚’æ§‹ç¯‰

exec ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨é€£æº

ğŸŒˆğŸ”¥ æœ€çµ‚çš„ãªå®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆå®Œå…¨ç‰ˆï¼‰
ã‚³ãƒ¼ãƒ‰
1. CLIï¼ˆclap enumï¼‰
2. signalsï¼ˆwriter/reader/validator/registryï¼‰
3. stateï¼ˆcurrent.json ä»–ï¼‰
4. state machineï¼ˆé·ç§»ã¨ emitï¼‰
5. history/snapshots/rollback
6. rubyï¼ˆruby-install or è‡ªå‰ç®¡ç†ï¼‰
7. deps solverï¼ˆbundler äº’æ› or ç‹¬è‡ªï¼‰
8. execï¼ˆRuby å®Ÿè¡Œç’°å¢ƒï¼‰
9. envï¼ˆPATH/GEM_HOME ç®¡ç†ï¼‰
10. arc init / install / run ã®çµ±åˆ
ã“ã‚Œã§ arc ã¯ å®Ÿéš›ã«å‹•ããƒ„ãƒ¼ãƒ«ã«ãªã‚‹ã€‚
